{"version":3,"file":"static/webpack/static\\development\\pages\\users.js.cdd01e869946d75d6f98.hot-update.js","sources":["webpack:///./components/AccountPicker.js"],"sourcesContent":["import { useIdentity } from \"../hooks/identity\";\r\nimport { DropdownItem } from '../components/MultilevelMenu';\r\nimport { FaPlus, FaCheck, \r\n    FaSkull, FaBolt, FaClock } from \"react-icons/fa\";\r\nimport { useRef, forwardRef, useState, useEffect } from \"react\";\r\nimport { Modal } from \"./layout/Modal\";\r\n\r\nimport s from \"../style/form.module.sass\"\r\nimport styled from \"../style/style.module.sass\";\r\nimport eyeStyle from \"../style/eye.module.sass\";\r\n\r\nimport { EyeOnMount } from \"./layout/EyeOfJudgement\";\r\nimport { RegisterForm, LoginForm, TabbedAccountForm } from \"./AccountForm\";\r\n\r\nimport axios from \"axios\";\r\nimport { apiUrl } from \"../constants\";\r\nimport { FallbackImgImg } from \"./FallbackImg\";\r\n\r\n\r\nexport function AccountPicker(props) {\r\n    var [id, axios] = useIdentity();\r\n    var [modalUser, setModalUser] = useState(-1);\r\n    var modalRef = useRef();\r\n\r\n    function onClick(idx) {\r\n        if (id.active === idx) \r\n            return id.setActive(null);  \r\n        if (id.users[idx].error) {\r\n            setModalUser(idx);\r\n            return modalRef.current.toggleModal();;\r\n        }   \r\n\r\n        id.setActive(idx)\r\n    }\r\n\r\n    function icon(idx) {\r\n        if (id.users[idx].error) {\r\n            return getIcon(id.users[idx]);\r\n        } else if (idx === id.active) {\r\n            return <FaCheck/>;\r\n        }\r\n    }\r\n\r\n    function addAccountClick(evt) {\r\n        setModalUser(-1);\r\n        modalRef.current.toggleModal();\r\n    }\r\n\r\n    if(modalUser > -1 && (!id.users[modalUser] || !id.users[modalUser].error)) {\r\n        setModalUser(-1);\r\n    }\r\n    useEffect(() => {setTimeout(props.reHeight, 100)}, [id.users])\r\n\r\n    return <>\r\n        {id.users.map((user, idx)=> {\r\n            return (\r\n            <DropdownItem \r\n                leftIcon={user.avatarUrl && <FallbackImgImg src={user.avatarUrl}/>}\r\n                text={user.username} \r\n                rightIcon={icon(idx)} \r\n                key = {idx}\r\n                onClick={() => onClick(idx)}/>\r\n        );})}\r\n        <DropdownItem leftIcon={<FaPlus/>} text=\"Add Acount\" onClick={addAccountClick}/>\r\n\r\n        <AccountModal ref={modalRef} user={id.users[modalUser] || undefined} id={id}/>\r\n    </>;\r\n    \r\n}\r\n\r\nexport const AccountModal = forwardRef(function AccModal(props, ref) {\r\n    var [deleteButtonClick, setDBC] = useState(false);\r\n    var [eyeSize, setEyeSize] = useState(150);\r\n\r\n    async function submit(data, register) {\r\n        console.log(\"ehre\");\r\n        \r\n        var registerResponse;\r\n        if(register) {\r\n            try{\r\n                registerResponse = await axios.post(`${apiUrl}/register`, data);\r\n            }catch(e){\r\n                if(e.response) {\r\n                    switch(e.response.status) {\r\n                        case 409:\r\n                            return \"username/email taken\"\r\n                        case 429:\r\n                            return \"ratelimit\"\r\n                        default:\r\n                            ref.current.toggleModal();\r\n                            return \"unexpected\"\r\n                    }\r\n                } else {\r\n                    ref.current.toggleModal();\r\n                    return \"unexpected\";\r\n                }\r\n            }\r\n            console.log(\"register:\", registerResponse);\r\n        }\r\n\r\n        var loginResponse;\r\n        try {\r\n            loginResponse = await axios.post(`${apiUrl}/login`, data);\r\n        } catch (e) {\r\n            if(e.response) {\r\n                switch(e.response.status) {\r\n                    case 403:\r\n                        if (register) {\r\n                            ref.current.toggleModal();\r\n                            return \"unexpected\";\r\n                        }\r\n                        return \"wrong credentials\"\r\n                    case 429:\r\n                        return \"ratelimit\"\r\n                    default:\r\n                        ref.current.toggleModal();\r\n                        return \"unexpected\"\r\n                }\r\n            } else {\r\n                ref.current.toggleModal();\r\n                return \"unexpected\";\r\n            }\r\n        }\r\n        console.log(\"login:\", loginResponse);\r\n        //add account\r\n\r\n        props.id.addUser(\"gamer\", data.username, loginResponse.data.access_token);\r\n        ref.current.toggleModal();\r\n    }\r\n\r\n    async function lol() {\r\n        await timeout(3000);\r\n    }\r\n\r\n    //default\r\n    var content = (<>\r\n        <TabbedAccountForm onSubmit={submit}/>\r\n        <hr style={{color: \"#717878\", marginTop: \"2.5em\"}}/>\r\n        <p style={{fontSize: \"1em\", color: \"#717878\"}}>(Did you see how cool the eye moved?)<br/><span className={styled.fabulous}>Fabulous!</span></p>\r\n    </>);\r\n    var eyeText = <div style={{color: \"#ff00fe\"}}><p style={{margin: \"0\"}}>Your Personal DAta.<br/></p><span className={eyeStyle.triggered} style={{display:\"inline-block\"}}>HAND IT OVER.</span></div>;\r\n    var color = [\"\", \"\"];\r\n\r\n    var user = props.user;\r\n    var icon;\r\n    var userFate = \"\";\r\n\r\n    var error = \"\";\r\n    if(user) error= user.error.err;\r\n\r\n    if(user) {\r\n        content = <></>;\r\n    }\r\n    switch(error) {\r\n        case \"TokenExpiredError\":\r\n            //expiry\r\n            eyeText = <p style={{color: \"#ff008f\"}}>Sowwy &gt;_&lt;</p>;\r\n            userFate = \"was automatically logged out.\";\r\n            content = <><p>Accounts stay logged in for 7 days.<br/>Yes, this is annoying. I know.<br/> <sup>too scared of oauth spec tho</sup></p>\r\n                        <p>Please reenter your password below.</p></>;\r\n            color = [\"#ff008f\", \"#fff\"]\r\n            break;\r\n        case \"NotBeforeError\":\r\n            //patience\r\n            eyeText = <p style={{color: \"#8e95ff\"}}>Be patient and let mystery unfold<br></br><i>-Albert EInstein</i></p>;\r\n            userFate = \"will soon be logged in.\";\r\n            content = <p >I don't expect this error to be caused anytime soon.<br/>This occurs when you log in faster than allowed on the server<br/>SO CALM DOWN, SANIC</p>\r\n            color= [\"#1400ff\", \"#ffd700\"]\r\n            break;\r\n        \r\n        case \"TokenClaimError\":\r\n            if(user.error.desc === \"invalid claims.\") {\r\n                //acc gone\r\n                eyeText = <i style={{color: \"#888\"}}>I`m afraid you won't be able to return</i>;\r\n                userFate = \"was permanently deleted.\";\r\n                color = [\"#888\", \"#000\"];\r\n                content = <>\r\n                    <h3>== Reasons for Deletion: ==</h3>\r\n                    <ul>\r\n                        <li>U dumb</li>\r\n                        <li>U deleted it urself</li>\r\n                        <li>Ur user-id changed, and your account still exists <br/><sub>that would be rlly dumb and a major security concern but jk maybe</sub></li>\r\n                        <li>Ur a toxic troglodyte</li>\r\n                        <li>U <i style={{color: \"#a4000e\"}}>stole</i> an email, and it's owner sent the <i style={{color: \"#a4000e\"}}>fire nation</i> ðŸ”¥ to <i style={{color: \"#a4000e\"}}>capture</i> you</li>\r\n                    </ul>\r\n                </>\r\n                break;\r\n            } else if(user.error.desc === \"insufficient claims.\") {\r\n                //forgery -- fall through\r\n            }\r\n\r\n        case \"JsonWebTokenError\":\r\n            //forgery\r\n            color = [\"#a4000e\", \"#e6f309\"];\r\n            eyeText = <><p style={{color: \"#a4000e\", fontSize:\"1.4em\"}} className={eyeStyle.triggered}>FOOL!</p></>;\r\n            userFate = \"is not properly logged in.\";\r\n            content = <>\r\n                Your Login-Token is either:\r\n                <ul>\r\n                    <li style={{color: \"#a4000e\"}}>A Counterfeit</li>\r\n                    <li>containing <i style={{color: \"#a4000e\"}}>false</i> information</li>\r\n                    <li>subject to other <i style={{color: \"#a4000e\"}}>malicious</i> acts of <b style={{color: \"#a4000e\"}}>Deception</b></li>\r\n                    <li>or outdated. <sub>this is my fault sorry</sub><br/> in this case, log in again</li>\r\n                </ul>\r\n            </>;\r\n            break;\r\n\r\n        default:\r\n    }\r\n    \r\n    icon = getIcon(user);\r\n\r\n    function onDeleteClick() {\r\n        setDBC((prev) => {\r\n            if(prev === false)\r\n                setTimeout(() => {\r\n                    console.log(user);\r\n                    props.id.removeUser(user.username);\r\n                    ref.current.toggleModal();\r\n                    setDBC(false);\r\n                }, 1000);\r\n            return true\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(window.screen.width<=600) setEyeSize(100);\r\n    }, []);\r\n\r\n    return <Modal ref={ref} className={s.accountFormWrap}>\r\n        <EyeOnMount size={eyeSize} baseColor={color[0]} innerColor={color[1]}></EyeOnMount>\r\n        <div style={{marginBottom: \"1em\", fontSize:\"1.1em\"}}>{eyeText}</div>\r\n        \r\n        <div className={styled.scroll}>\r\n            {user && <h1><span className={s.usernameHighlight}>{user.username}</span> ~~ {userFate}</h1>}\r\n            <div>{\r\n                content\r\n            }</div>\r\n            {user && <button className={deleteButtonClick ? s.removeButton+\" \"+s.clicked : s.removeButton} onClick={onDeleteClick}>{icon} Remove Entry</button>}\r\n        </div>\r\n    </Modal>\r\n});\r\n\r\nfunction getIcon(user) {\r\n    if(!user)\r\n        return;\r\n\r\n    switch(user.error.icon) {\r\n        case \"bolt\":\r\n            return <FaBolt data-error/>;\r\n        case \"time\":\r\n            return <FaClock data-error/>;\r\n        case \"death\":\r\n            return <FaSkull data-error/>;\r\n    }\r\n}\r\n\r\nfunction timeout(ms) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAtDA;AACA;AAwDA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AANA;AAQA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;;A","sourceRoot":""}